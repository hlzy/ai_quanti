# AI对话变量功能完整指南

## 版本信息
- **版本**：v0.3
- **更新日期**：2026年2月18日

---

## 目录
1. [变量概览](#变量概览)
2. [K线数据变量](#k线数据变量)
3. [仓位信息变量](#仓位信息变量)
4. [变量组合使用](#变量组合使用)
5. [实战案例](#实战案例)
6. [快速参考](#快速参考)

---

## 变量概览

AI对话功能支持三大类变量，可以在对话中直接引用获取数据：

| 变量类型 | 变量名称 | 功能说明 |
|---------|---------|---------|
| **K线数据** | `日K`、`周K`、`1分钟K` | 获取股票K线数据和技术指标 |
| **仓位信息** | `持仓` | 获取所有持仓股票详细信息 |
| **资金信息** | `可用资金` | 获取账户现金余额 |

---

## K线数据变量

### 格式规范

```
K线类型_股票_窗口_指标
```

### 参数说明

#### 1. K线类型（必填）
- `日K` - 日线数据
- `周K` - 周线数据
- `1分钟K` - 分钟线数据

#### 2. 股票（选填）
- 填写股票代码或名称
- 不填则使用当前选中股票
- 示例：`688385`、`复旦微电`、`000001`

#### 3. 窗口（选填）
- 格式：`数字+天`，如 `30天`、`360天`
- 默认值：
  - 日K：60天
  - 周K：360天
  - 1分钟K：2天（1440分钟）

#### 4. 指标（选填）
- 支持的指标：`MACD`、`EMA`、`RSI`
- 多个指标用 `&` 连接，如：`MACD&EMA&RSI`
- 仅日K线支持技术指标

### 使用示例

```
# 简洁格式
日K

# 指定窗口
日K__30天

# 指定指标
日K__30天_MACD

# 完整格式
日K_688385_30天_MACD&EMA&RSI

# 其他股票
日K_000001_60天_RSI

# 周K线
周K__360天_MACD

# 分钟线
1分钟K
```

### 输出内容

**基础K线数据**：
- 日期/时间
- 开盘价
- 收盘价
- 最高价
- 最低价
- 成交量

**技术指标**（如指定）：
- MACD：MACD值、信号线、柱状图
- EMA：EMA(12)、EMA(26)
- RSI：RSI(6)、RSI(12)、RSI(24)

---

## 仓位信息变量

### 持仓变量

**变量名**：`持仓`

**输出内容**：
```
股票代码	股票名称	持仓数量	成本价	当前价	市值	盈亏金额	盈亏比例
688385	复旦微电	3,100	82.64	85.20	264,120.00	7,936.00	9.60%
688313	仕佳光子	2,400	80.27	78.50	188,400.00	-4,248.00	-5.29%

--- 汇总 ---
持仓数量: 2 只
总市值: 452,520.00
总成本: 448,832.00
总盈亏: 3,688.00
```

**使用场景**：
- 查看当前持仓情况
- 分析仓位配置
- 评估风险敞口
- 制定调仓计划

### 可用资金变量

**变量名**：`可用资金`

**输出内容**：
```
可用资金: 160,000.00 元
```

**使用场景**：
- 检查资金余额
- 评估加仓空间
- 资金利用率分析

---

## 变量组合使用

### 组合1：K线 + 持仓

**场景**：结合技术分析和持仓情况做决策

```
根据 持仓 和当前股票的 日K__30天_MACD 判断是否适合加仓
```

**AI分析维度**：
- 当前持仓比例
- 技术指标信号
- 风险收益比
- 加仓建议

---

### 组合2：持仓 + 可用资金

**场景**：仓位配置评估

```
分析 持仓 和 可用资金 的配置是否合理
```

**AI分析维度**：
- 资金利用率
- 现金比例
- 仓位集中度
- 配置建议

---

### 组合3：多股票K线对比

**场景**：对比不同股票的技术形态

```
对比 日K_688385_30天_MACD 和 日K_000001_30天_MACD 的走势
```

**AI分析维度**：
- 趋势对比
- 强弱关系
- 相关性分析
- 操作建议

---

### 组合4：全方位分析

**场景**：综合多个维度制定策略

```
综合 持仓、可用资金、日K__30天_MACD&RSI 制定下周操作计划
```

**AI分析维度**：
- 持仓状况
- 资金状况
- 技术形态
- 市场环境
- 具体操作计划

---

## 实战案例

### 案例1：日内交易

**需求**：判断是否有日内做T机会

**对话**：
```
用户：分析 1分钟K 的走势，看看今天有没有做T机会

AI：根据今天的1分钟K线数据...
    【盘口分析】
    - 开盘后震荡上行，9:45-10:00成交放量
    - 10:30-11:00回调，量能萎缩
    
    【做T建议】
    有低吸高抛机会：
    1. 回调至84.5-85.0区间可低吸
    2. 反弹至86.0-86.5区间可高抛
    3. 建议操作仓位：不超过总仓位的30%
```

---

### 案例2：波段交易

**需求**：寻找中期持有机会

**对话**：
```
用户：根据 日K__60天_MACD&RSI 和 持仓 情况，判断是否适合波段持有

AI：【技术分析】
    - MACD：金叉形成，趋势转多
    - RSI(12)：52，中性偏强
    - 均线：突破EMA(26)
    
    【持仓情况】
    - 当前持仓：3,100股，占总仓位57%
    - 成本价：82.64元
    - 浮盈：+9.60%
    
    【波段建议】
    适合波段持有：
    1. 目标位：92-95元区间（约15-20%收益）
    2. 止损位：80元（-3.2%）
    3. 持有周期：2-3周
```

---

### 案例3：风险管理

**需求**：评估当前风险水平

**对话**：
```
用户：查看 持仓 和 可用资金，评估一下当前的风险敞口

AI：【风险评估】
    
    【仓位结构】
    - 688385：占总资产 42%
    - 688313：占总资产 31%
    - 现金：占总资产 26%
    
    【风险等级】中等
    
    【风险点】
    1. 仓位集中：两只股票占73%，集中度偏高
    2. 行业单一：均为科创板科技股，板块风险
    3. 现金比例：26%，安全垫适中
    
    【建议】
    1. 考虑增加1-2只其他板块股票分散风险
    2. 单只股票仓位控制在40%以内
    3. 保持20-30%现金应对突发情况
```

---

### 案例4：调仓决策

**需求**：根据市场情况调整持仓

**对话**：
```
用户：对比 持仓 中两只股票的 日K__30天_MACD，判断是否需要调仓

AI：【持仓对比】
    
    688385 复旦微电：
    - 持仓：3,100股，浮盈+9.60%
    - MACD：金叉，柱状图放大，强势
    - 建议：继续持有，可考虑加仓
    
    688313 仕佳光子：
    - 持仓：2,400股，浮亏-5.29%
    - MACD：死叉，柱状图缩小，弱势
    - 建议：减仓至1,500股，降低仓位
    
    【调仓方案】
    1. 卖出688313约900股，回收资金约70,000元
    2. 加仓688385约800股，使用资金约68,000元
    3. 调整后：688385占比提升至52%，688313降至20%
```

---

## 快速参考

### 常用对话模版

#### 每日检查
```
查看 持仓 的盈亏情况
```

#### 周度回顾
```
分析 持仓 和 可用资金 的配置，结合本周走势给出下周建议
```

#### 买入决策
```
根据 日K__30天_MACD&RSI 和 可用资金 判断是否适合买入
```

#### 卖出决策
```
根据 持仓 的盈亏和 日K__60天_MACD 判断是否需要止盈或止损
```

#### 加仓决策
```
结合 持仓、可用资金 和 日K__30天_MACD 判断是否适合加仓
```

#### 仓位调整
```
对比 持仓 中各股票的 日K__30天，给出调仓建议
```

---

### 变量语法速查表

| 场景 | 语法示例 | 说明 |
|------|---------|------|
| 当前股票日K | `日K` | 最简格式 |
| 指定窗口 | `日K__30天` | 省略股票和指标 |
| 带MACD | `日K__30天_MACD` | 常用组合 |
| 多指标 | `日K__60天_MACD&EMA&RSI` | 全面分析 |
| 其他股票 | `日K_000001_30天_MACD` | 跨股票查询 |
| 周K线 | `周K__360天_RSI` | 长期分析 |
| 分钟线 | `1分钟K` | 日内分析 |
| 查看持仓 | `持仓` | 仓位信息 |
| 查看资金 | `可用资金` | 资金余额 |

---

### 使用技巧

#### 1. 数据更新
- 使用K线变量前点击"更新数据"
- 使用持仓变量前在"持仓管理"页更新价格

#### 2. 变量组合
- 建议每次使用2-3个变量
- 避免一次使用过多变量（影响性能）

#### 3. 窗口选择
- 短线：日K 30天
- 波段：日K 60天 + 周K 360天
- 长线：周K 720天

#### 4. 指标组合
- 趋势判断：MACD + EMA
- 超买超卖：RSI
- 全面分析：MACD + EMA + RSI

---

### 常见问题

**Q1：为什么点击"选择对话模版"按钮没反应？**
A：需要先在自选股列表中选择一只股票。

**Q2：变量不生效怎么办？**
A：检查：
1. 变量格式是否正确
2. 数据是否已更新
3. 股票代码是否存在

**Q3：持仓数据不准确？**
A：在"持仓管理"页点击"更新所有价格"按钮。

**Q4：可以同时使用多个变量吗？**
A：可以，建议2-3个为宜。

**Q5：1分钟K线支持指标吗？**
A：目前只有日K线支持技术指标。

---

## 附录

### 支持的股票类型
- ✅ A股（上海、深圳）
- ✅ 科创板
- ✅ 创业板
- ✅ 指数（上证、深证等）
- ✅ ETF基金

### 支持的技术指标
- ✅ MACD（指数移动平均线）
- ✅ EMA（指数平滑移动平均）
- ✅ RSI（相对强弱指标）
- 🔜 KDJ（计划中）
- 🔜 BOLL（计划中）

### 相关文档
- [AI对话功能升级说明](./AI对话功能升级说明.md)
- [AI对话功能使用示例](./AI对话功能使用示例.md)
- [持仓变量功能说明](./持仓变量功能说明.md)

---

*版本历史*
- v0.3 (2026-02-18)：新增持仓和可用资金变量
- v0.2 (2026-02-18)：新增变量解析功能
- v0.1 (2026-02-15)：初始版本

*本文档持续更新中*
