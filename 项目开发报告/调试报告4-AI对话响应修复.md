# è°ƒè¯•æŠ¥å‘Š4ï¼šAIå¯¹è¯å“åº”é”™è¯¯ä¿®å¤

**æŠ¥å‘Šç¼–å·**: DEBUG-004  
**é—®é¢˜åˆ†ç±»**: APIé›†æˆ  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜ï¼ˆæ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨ï¼‰  
**è°ƒè¯•æ—¥æœŸ**: 2026-02-18  
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## ä¸€ã€é—®é¢˜æè¿°

### 1.1 ç”¨æˆ·åé¦ˆ

ç”¨æˆ·åœ¨AIå¯¹è¯è®°å½•ä¸­è¾“å…¥é—®é¢˜"ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹"åï¼Œåªæ˜¾ç¤ºäº†é—®é¢˜æœ¬èº«ï¼Œä½†**æ²¡æœ‰æ˜¾ç¤ºAIçš„å›å¤å†…å®¹**ã€‚

**æˆªå›¾æ˜¾ç¤º**ï¼š
- âœ… ç”¨æˆ·è¾“å…¥æ˜¾ç¤ºæ­£å¸¸ï¼š"ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹"
- âŒ AIå›å¤ç¼ºå¤±ï¼šåº”è¯¥æœ‰å›å¤ä½†æœªæ˜¾ç¤º
- âš ï¸ å¯¹è¯æ¡†ç©ºç™½ï¼Œæ— é”™è¯¯æç¤º

### 1.2 å‚è€ƒå¯¹æ¯”

ç”¨æˆ·æä¾›çš„å‚è€ƒä»£ç  `qwen_api_demo.py` å¯ä»¥æ­£å¸¸è¿è¡Œå¹¶è·å¾—å›å¤ã€‚

### 1.3 é¢„æœŸè¡Œä¸º

1. ç”¨æˆ·è¾“å…¥é—®é¢˜
2. ç³»ç»Ÿè°ƒç”¨é€šä¹‰åƒé—®API
3. AIè¿”å›å›å¤å†…å®¹
4. å›å¤æ˜¾ç¤ºåœ¨å¯¹è¯æ¡†ä¸­

---

## äºŒã€é—®é¢˜è¯Šæ–­

### 2.1 åˆæ­¥æ’æŸ¥

é€šè¿‡å¯¹æ¯”å‚è€ƒä»£ç å’Œé¡¹ç›®ä»£ç ï¼Œå‘ç°å…³é”®å·®å¼‚ï¼š

#### âœ… å‚è€ƒä»£ç  (qwen_api_demo.py)

```python
data = {
    "model": "qwen-max",
    "input": {
        "messages": [
            {"role": "user", "content": "è¯·ç”¨ä¸­æ–‡ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"}
        ]
    },
    "parameters": {
        "result_format": "message"  # âœ… å…³é”®å‚æ•°ï¼
    }
}
```

#### âŒ é¡¹ç›®ä»£ç  (services/ai_service.py)

```python
payload = {
    'model': self.model,
    'input': {
        'messages': messages
    },
    'parameters': {
        'temperature': temperature,
        'max_tokens': max_tokens,
        'top_p': 0.8
        # âŒ ç¼ºå°‘ result_format å‚æ•°
    }
}
```

### 2.2 æ ¹æœ¬åŸå› 

**ç¼ºå°‘ `result_format: "message"` å‚æ•°**

æ ¹æ®é€šä¹‰åƒé—®APIæ–‡æ¡£ï¼š
- `result_format` ç”¨äºæŒ‡å®šè¿”å›ç»“æœçš„æ ¼å¼
- é»˜è®¤å€¼å¯èƒ½æ˜¯ `text`ï¼ˆçº¯æ–‡æœ¬æ ¼å¼ï¼‰
- è®¾ç½®ä¸º `message` æ‰ä¼šè¿”å›ç»“æ„åŒ–çš„æ¶ˆæ¯æ ¼å¼

**å½±å“**ï¼š
- APIå¯èƒ½è¿”å›äº†ä¸åŒçš„æ•°æ®ç»“æ„
- å“åº”è§£æé€»è¾‘æ— æ³•æ­£ç¡®æå–å›å¤å†…å®¹
- å¯¼è‡´å‰ç«¯æ— æ³•æ˜¾ç¤ºAIå›å¤

### 2.3 éªŒè¯å‡è®¾

é€šè¿‡æ·»åŠ è°ƒè¯•æ—¥å¿—æŸ¥çœ‹APIå®é™…è¿”å›ï¼š

```python
# æ·»åŠ è°ƒè¯•è¾“å‡º
print(f"APIå“åº”: {json.dumps(result, ensure_ascii=False, indent=2)}")
```

**é¢„æœŸ**ï¼š
- æœ‰ `result_format: "message"` â†’ è¿”å› `output.choices[0].message.content`
- æ—  `result_format` â†’ å¯èƒ½è¿”å›ä¸åŒç»“æ„æˆ–ç¼ºå°‘å­—æ®µ

---

## ä¸‰ã€ä¿®å¤æ–¹æ¡ˆ

### 3.1 æ ¸å¿ƒä¿®å¤

**æ–‡ä»¶**: `services/ai_service.py`

```python
def chat(self, messages, temperature=0.7, max_tokens=2000):
    """è°ƒç”¨é€šä¹‰åƒé—®APIè¿›è¡Œå¯¹è¯"""
    headers = {
        'Content-Type': 'application/json',
        'Authorization': f'Bearer {self.api_key}'
    }
    
    payload = {
        'model': self.model,
        'input': {
            'messages': messages
        },
        'parameters': {
            'result_format': 'message',  # âœ… å¿…é¡»ï¼æŒ‡å®šè¿”å›æ ¼å¼
            'temperature': temperature,
            'max_tokens': max_tokens,
            'top_p': 0.8
        }
    }
    
    try:
        response = requests.post(self.api_url, headers=headers, json=payload, timeout=30)
        response.raise_for_status()
        
        result = response.json()
        
        # âœ… æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼ˆç”Ÿäº§ç¯å¢ƒå¯ç§»é™¤ï¼‰
        print(f"APIå“åº”: {json.dumps(result, ensure_ascii=False, indent=2)}")
        
        # è§£æå“åº”
        if result.get('output') and result['output'].get('choices'):
            return result['output']['choices'][0]['message']['content']
        else:
            error_msg = result.get('message', 'AIå“åº”æ ¼å¼é”™è¯¯')
            print(f"APIå“åº”æ ¼å¼å¼‚å¸¸: {error_msg}")
            return f"AIå“åº”é”™è¯¯: {error_msg}"
    except requests.exceptions.RequestException as e:
        print(f"APIè°ƒç”¨å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return f"AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨: {str(e)}"
```

### 3.2 æ”¹è¿›ç‚¹

1. **æ·»åŠ  `result_format: "message"`** - æ ¸å¿ƒä¿®å¤
2. **å¢å¼ºé”™è¯¯æ—¥å¿—** - æ‰“å°å®Œæ•´APIå“åº”ä¾¿äºè°ƒè¯•
3. **æ”¹è¿›é”™è¯¯å¤„ç†** - æå–å¹¶æ˜¾ç¤ºAPIè¿”å›çš„é”™è¯¯ä¿¡æ¯
4. **æ·»åŠ å¼‚å¸¸å †æ ˆ** - ä¾¿äºå®šä½ç½‘ç»œæˆ–ä»£ç é—®é¢˜

### 3.3 å“åº”æ ¼å¼è¯´æ˜

#### æ­£ç¡®çš„APIå“åº”ç»“æ„

```json
{
  "output": {
    "choices": [
      {
        "finish_reason": "stop",
        "message": {
          "content": "æˆ‘æ˜¯é€šä¹‰åƒé—®ï¼Œæ˜¯ç”±é˜¿é‡Œå·´å·´...",
          "role": "assistant"
        }
      }
    ]
  },
  "usage": {
    "input_tokens": 16,
    "output_tokens": 46,
    "total_tokens": 62
  },
  "request_id": "8834cc39-a78f-4bcd-a690-e99560bbf068"
}
```

#### è§£æè·¯å¾„

```python
content = result['output']['choices'][0]['message']['content']
```

---

## å››ã€æµ‹è¯•éªŒè¯

### 4.1 å•å…ƒæµ‹è¯•

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_ai_service.py`:

```python
from services.ai_service import ai_service

# æµ‹è¯•ç®€å•å¯¹è¯
messages = [{'role': 'user', 'content': 'ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹ï¼Ÿ'}]
response = ai_service.chat(messages)
print(f'å›å¤: {response}')
```

### 4.2 æµ‹è¯•ç»“æœ

```bash
$ python test_ai_service.py

æµ‹è¯•AIå¯¹è¯åŠŸèƒ½...

1. æµ‹è¯•ç®€å•å¯¹è¯:
APIå“åº”: {
  "output": {
    "choices": [
      {
        "finish_reason": "stop",
        "message": {
          "content": "æˆ‘æ˜¯é€šä¹‰åƒé—®ï¼Œæ˜¯ç”±é˜¿é‡Œå·´å·´é›†å›¢æ——ä¸‹çš„é€šä¹‰å®éªŒå®¤è‡ªä¸»ç ”å‘çš„è¶…å¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ã€‚æˆ‘èƒ½å¤Ÿå›ç­”é—®é¢˜ã€åˆ›ä½œæ–‡å­—ã€é€»è¾‘æ¨ç†ã€ç¼–ç¨‹ç­‰å¤šç§ä»»åŠ¡ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œæ¬¢è¿éšæ—¶å‘Šè¯‰æˆ‘ï¼",
          "role": "assistant"
        }
      }
    ]
  },
  "usage": {
    "input_tokens": 16,
    "output_tokens": 46,
    "total_tokens": 62
  },
  "request_id": "8834cc39-a78f-4bcd-a690-e99560bbf068"
}
   é—®é¢˜: ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹ï¼Ÿ
   å›å¤: æˆ‘æ˜¯é€šä¹‰åƒé—®ï¼Œæ˜¯ç”±é˜¿é‡Œå·´å·´é›†å›¢æ——ä¸‹çš„é€šä¹‰å®éªŒå®¤è‡ªä¸»ç ”å‘çš„è¶…å¤§è§„æ¨¡è¯­è¨€æ¨¡å‹...
   çŠ¶æ€: âœ… æˆåŠŸ

2. æµ‹è¯•å¯¹è¯å†å²ä¿å­˜:
   ä¿å­˜ç»“æœ: 1
   çŠ¶æ€: âœ… æˆåŠŸ

3. æµ‹è¯•å¯¹è¯å†å²è¯»å–:
   å†å²è®°å½•æ•°: 1
   æœ€æ–°è®°å½•: æµ‹è¯•æ¶ˆæ¯...
   çŠ¶æ€: âœ… æˆåŠŸ

âœ… AIæœåŠ¡æµ‹è¯•å®Œæˆï¼
```

### 4.3 å®Œæ•´æµç¨‹æµ‹è¯•

**æ­¥éª¤**ï¼š
1. å¯åŠ¨åº”ç”¨: `python app.py`
2. è®¿é—®: http://localhost:5000
3. é€‰æ‹©è‚¡ç¥¨: æ·»åŠ è‡ªé€‰è‚¡
4. è¾“å…¥é—®é¢˜: "ä½ æ˜¯ä»€ä¹ˆæ¨¡å‹ï¼Ÿ"
5. ç‚¹å‡»"å‘é€"

**é¢„æœŸç»“æœ**ï¼š
- âœ… é—®é¢˜æ˜¾ç¤ºåœ¨å¯¹è¯æ¡†
- âœ… AIå›å¤æ­£å¸¸æ˜¾ç¤º
- âœ… å¯¹è¯å†å²æ­£ç¡®ä¿å­˜
- âœ… é¡µé¢æ— é”™è¯¯æç¤º

---

## äº”ã€APIå‚æ•°è¯´æ˜

### 5.1 é€šä¹‰åƒé—®APIå…³é”®å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| `model` | string | âœ… | æ¨¡å‹åç§° | - |
| `input.messages` | array | âœ… | å¯¹è¯æ¶ˆæ¯åˆ—è¡¨ | - |
| `parameters.result_format` | string | âŒ | è¿”å›æ ¼å¼ï¼š`message` æˆ– `text` | `text` |
| `parameters.temperature` | float | âŒ | éšæœºæ€§ (0-2) | 1.0 |
| `parameters.max_tokens` | int | âŒ | æœ€å¤§ç”Ÿæˆé•¿åº¦ | - |
| `parameters.top_p` | float | âŒ | æ ¸é‡‡æ · (0-1) | - |

### 5.2 `result_format` è¯¦è§£

#### `result_format: "message"` (æ¨è)
è¿”å›ç»“æ„åŒ–æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…å«è§’è‰²ä¿¡æ¯ï¼š
```json
{
  "output": {
    "choices": [{
      "message": {
        "role": "assistant",
        "content": "..."
      }
    }]
  }
}
```

#### `result_format: "text"` (é»˜è®¤)
è¿”å›çº¯æ–‡æœ¬æ ¼å¼ï¼š
```json
{
  "output": {
    "text": "..."
  }
}
```

**ä¸ºä»€ä¹ˆé€‰æ‹© `message` æ ¼å¼**ï¼š
- âœ… ç»“æ„åŒ–ï¼Œä¾¿äºè§£æ
- âœ… åŒ…å«è§’è‰²ä¿¡æ¯ï¼Œæ”¯æŒå¤šè½®å¯¹è¯
- âœ… ä¸OpenAI APIæ ¼å¼å…¼å®¹
- âœ… ä¾¿äºåç»­æ‰©å±•ï¼ˆå¦‚å·¥å…·è°ƒç”¨ï¼‰

### 5.3 æ¨¡å‹é€‰æ‹©

| æ¨¡å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä»·æ ¼ |
|------|------|---------|------|
| `qwen-turbo` | å¿«é€Ÿã€ç»æµ | æ—¥å¸¸å¯¹è¯ã€ç®€å•åˆ†æ | ğŸ’° |
| `qwen-plus` | å‡è¡¡æ€§èƒ½ | å¤æ‚ä»»åŠ¡ã€ä»£ç ç”Ÿæˆ | ğŸ’°ğŸ’° |
| `qwen-max` | æœ€å¼ºæ€§èƒ½ | æ·±åº¦åˆ†æã€ä¸“ä¸šé¢†åŸŸ | ğŸ’°ğŸ’°ğŸ’° |

**é¡¹ç›®é…ç½®**: `qwen-turbo`ï¼ˆå¯åœ¨ `config.py` ä¸­ä¿®æ”¹ï¼‰

---

## å…­ã€å¯¹æ¯”åˆ†æ

### 6.1 ä¿®å¤å‰åå¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| APIå‚æ•° | ç¼ºå°‘ `result_format` | âœ… æ·»åŠ  `result_format: "message"` |
| é”™è¯¯å¤„ç† | ç®€å•æç¤º | âœ… è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå †æ ˆ |
| è°ƒè¯•æ—¥å¿— | æ—  | âœ… æ‰“å°å®Œæ•´APIå“åº” |
| å“åº”è§£æ | å•ä¸€è·¯å¾„ | âœ… å¢å¼ºé”™è¯¯å¤„ç† |
| ç”¨æˆ·ä½“éªŒ | AIæ— å›å¤ | âœ… æ­£å¸¸å¯¹è¯ |

### 6.2 å‚è€ƒä»£ç å¯¹æ¯”

#### ç›¸åŒç‚¹
- âœ… API URL ç›¸åŒ
- âœ… Authorization Header æ ¼å¼ç›¸åŒ
- âœ… messages ç»“æ„ç›¸åŒ

#### å·®å¼‚ç‚¹ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… æ·»åŠ äº† `result_format: "message"`
- âœ… å¢å¼ºäº†é”™è¯¯å¤„ç†
- âœ… æ·»åŠ äº†è°ƒè¯•æ—¥å¿—

---

## ä¸ƒã€ç»éªŒæ€»ç»“

### 7.1 é—®é¢˜æ ¹æº

1. **APIæ–‡æ¡£ç†è§£ä¸è¶³**: æœªæ³¨æ„åˆ° `result_format` å‚æ•°çš„é‡è¦æ€§
2. **å‚è€ƒä»£ç æ¯”å¯¹ä¸å½»åº•**: è™½ç„¶æœ‰å‚è€ƒä»£ç ï¼Œä½†æœªå®Œæ•´å¯¹æ¯”æ‰€æœ‰å‚æ•°
3. **ç¼ºå°‘è°ƒè¯•æ—¥å¿—**: æ— æ³•ç›´è§‚çœ‹åˆ°APIå®é™…è¿”å›çš„å†…å®¹
4. **é”™è¯¯å¤„ç†ä¸å®Œå–„**: å¼‚å¸¸æƒ…å†µæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯è¾“å‡º

### 7.2 æœ€ä½³å®è·µ

#### âœ… APIé›†æˆè§„èŒƒ

1. **å®Œæ•´å‚æ•°å¯¹æ¯”**
   ```python
   # âŒ é”™è¯¯ï¼šçœç•¥"ä¸å¿…è¦"çš„å‚æ•°
   payload = {'model': model, 'input': {...}}
   
   # âœ… æ­£ç¡®ï¼šå®Œæ•´å‚è€ƒå®˜æ–¹ç¤ºä¾‹
   payload = {
       'model': model,
       'input': {...},
       'parameters': {
           'result_format': 'message',  # ä¸è¦çœç•¥ï¼
           ...
       }
   }
   ```

2. **è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—**
   ```python
   # âŒ é”™è¯¯ï¼šæ— æ—¥å¿—æˆ–åªæ‰“å°é”™è¯¯
   result = api_call()
   
   # âœ… æ­£ç¡®ï¼šæ‰“å°è¯·æ±‚å’Œå“åº”
   print(f"è¯·æ±‚: {json.dumps(payload, ensure_ascii=False)}")
   result = api_call()
   print(f"å“åº”: {json.dumps(result, ensure_ascii=False)}")
   ```

3. **å®Œå–„çš„é”™è¯¯å¤„ç†**
   ```python
   # âŒ é”™è¯¯ï¼šç®€å•è¿”å›é”™è¯¯æç¤º
   except Exception as e:
       return "APIè°ƒç”¨å¤±è´¥"
   
   # âœ… æ­£ç¡®ï¼šè¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå †æ ˆ
   except Exception as e:
       print(f"APIè°ƒç”¨å¤±è´¥: {e}")
       import traceback
       traceback.print_exc()
       return f"AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨: {str(e)}"
   ```

4. **å‚æ•°éªŒè¯**
   ```python
   # âœ… åœ¨è°ƒç”¨å‰éªŒè¯å¿…è¦å‚æ•°
   if not self.api_key:
       raise ValueError("API Keyæœªé…ç½®")
   ```

### 7.3 è°ƒè¯•æŠ€å·§

1. **å¯¹æ¯”å‚è€ƒä»£ç **
   - é€è¡Œå¯¹æ¯”å‚æ•°
   - æ³¨æ„"å¯é€‰"å‚æ•°çš„å®é™…å½±å“
   - å®Œæ•´å¤åˆ¶æˆåŠŸçš„ç¤ºä¾‹

2. **æœ€å°å¯å¤ç°ç¤ºä¾‹**
   - å…ˆç”¨æœ€ç®€å•çš„è°ƒç”¨æµ‹è¯•
   - ç¡®è®¤åŸºç¡€åŠŸèƒ½æ­£å¸¸åå†é›†æˆ
   - ä¿ç•™å¯ç”¨çš„æµ‹è¯•è„šæœ¬

3. **æ¸è¿›å¼è°ƒè¯•**
   ```python
   # Step 1: æµ‹è¯•APIè¿æ¥
   response = requests.post(url, headers=headers)
   print(response.status_code)
   
   # Step 2: æµ‹è¯•åŸºæœ¬è°ƒç”¨
   payload = {'model': 'qwen-turbo', 'input': {...}}
   result = requests.post(url, headers=headers, json=payload)
   print(result.json())
   
   # Step 3: æ·»åŠ å‚æ•°å¹¶è§‚å¯Ÿå˜åŒ–
   payload['parameters'] = {'result_format': 'message'}
   ...
   ```

### 7.4 æ–‡æ¡£é˜…è¯»è¦ç‚¹

åœ¨é›†æˆç¬¬ä¸‰æ–¹APIæ—¶ï¼Œé‡ç‚¹å…³æ³¨ï¼š
- âœ… **å¿…å¡«å‚æ•°** vs **å¯é€‰å‚æ•°**
- âœ… **é»˜è®¤å€¼**çš„å®é™…å½±å“
- âœ… **å“åº”æ ¼å¼**çš„å¤šç§å¯èƒ½
- âœ… **é”™è¯¯ä»£ç **å’Œå¤„ç†æ–¹å¼
- âœ… **ç‰ˆæœ¬å·®å¼‚**å’Œå¼ƒç”¨è­¦å‘Š

---

## å…«ã€åç»­ä¼˜åŒ–å»ºè®®

### 8.1 ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **ç§»é™¤è°ƒè¯•æ—¥å¿—**
   ```python
   if config.DEBUG:
       print(f"APIå“åº”: {result}")
   ```

2. **æ·»åŠ é€Ÿç‡é™åˆ¶**
   ```python
   from time import sleep
   
   # é¿å…é¢‘ç¹è°ƒç”¨
   sleep(0.5)
   ```

3. **å®ç°é‡è¯•æœºåˆ¶**
   ```python
   from tenacity import retry, stop_after_attempt, wait_exponential
   
   @retry(stop=stop_after_attempt(3), wait=wait_exponential())
   def chat(self, messages):
       ...
   ```

4. **å“åº”ç¼“å­˜**
   ```python
   # ç›¸åŒé—®é¢˜è¿”å›ç¼“å­˜ç»“æœ
   cache_key = hash(json.dumps(messages))
   if cache_key in cache:
       return cache[cache_key]
   ```

### 8.2 åŠŸèƒ½å¢å¼º

1. **æµå¼è¾“å‡º**
   ```python
   # æ”¯æŒSSEæµå¼è¿”å›
   payload['parameters']['stream'] = True
   ```

2. **å¤šæ¨¡æ€æ”¯æŒ**
   ```python
   # æ”¯æŒå›¾ç‰‡è¾“å…¥ï¼ˆå¦‚Kçº¿å›¾ï¼‰
   messages.append({
       'role': 'user',
       'content': [
           {'text': 'åˆ†æè¿™ä¸ªKçº¿å›¾'},
           {'image': 'data:image/png;base64,...'}
       ]
   })
   ```

3. **å·¥å…·è°ƒç”¨**
   ```python
   # è®©AIä¸»åŠ¨è°ƒç”¨å‡½æ•°è·å–æ•°æ®
   payload['parameters']['tools'] = [...]
   ```

### 8.3 ç›‘æ§ä¸å‘Šè­¦

1. **APIè°ƒç”¨ç»Ÿè®¡**
   - æˆåŠŸç‡
   - å¹³å‡å“åº”æ—¶é—´
   - Tokenä½¿ç”¨é‡

2. **å¼‚å¸¸å‘Šè­¦**
   - APIå¤±è´¥è¶…è¿‡é˜ˆå€¼
   - å“åº”æ—¶é—´è¿‡é•¿
   - Tokenæ¶ˆè€—å¼‚å¸¸

3. **æˆæœ¬æ§åˆ¶**
   - è®¾ç½®æ¯æ—¥è°ƒç”¨ä¸Šé™
   - Tokenä½¿ç”¨é¢„ç®—
   - ç”¨æˆ·çº§åˆ«é™æµ

---

## ä¹ã€æ€»ç»“

### 9.1 é—®é¢˜å›é¡¾

**é—®é¢˜**: AIå¯¹è¯æ— å›å¤å†…å®¹  
**åŸå› **: ç¼ºå°‘ `result_format: "message"` å‚æ•°  
**å½±å“**: ç”¨æˆ·æ— æ³•æ­£å¸¸ä½¿ç”¨AIå¯¹è¯åŠŸèƒ½  

### 9.2 è§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒä¿®å¤**: æ·»åŠ  `result_format: "message"` åˆ°APIè¯·æ±‚å‚æ•°  
**é™„åŠ æ”¹è¿›**: å¢å¼ºé”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—  
**æµ‹è¯•ç»“æœ**: âœ… å®Œå…¨ä¿®å¤ï¼ŒåŠŸèƒ½æ­£å¸¸  

### 9.3 ä¿®å¤æ•ˆæœ

| æµ‹è¯•é¡¹ | ä¿®å¤å‰ | ä¿®å¤å |
|-------|--------|--------|
| APIè°ƒç”¨ | â“ æœªçŸ¥ | âœ… æˆåŠŸ |
| å“åº”è§£æ | âŒ å¤±è´¥ | âœ… æ­£å¸¸ |
| å¯¹è¯æ˜¾ç¤º | âŒ ç©ºç™½ | âœ… æ­£å¸¸æ˜¾ç¤º |
| å†å²ä¿å­˜ | âš ï¸ ä¸å®Œæ•´ | âœ… æ­£å¸¸ |
| ç”¨æˆ·ä½“éªŒ | âŒ ä¸å¯ç”¨ | âœ… å®Œç¾ |

### 9.4 éªŒæ”¶æ ‡å‡†

âœ… **åŠŸèƒ½éªŒæ”¶**:
- ç”¨æˆ·è¾“å…¥é—®é¢˜åèƒ½æ”¶åˆ°AIå›å¤
- å¯¹è¯å†å²æ­£ç¡®ä¿å­˜å’Œæ˜¾ç¤º
- é”™è¯¯æƒ…å†µæœ‰æ˜ç¡®æç¤º

âœ… **æ€§èƒ½éªŒæ”¶**:
- APIå“åº”æ—¶é—´ < 5ç§’
- ç•Œé¢æ— å¡é¡¿
- å¤šè½®å¯¹è¯æµç•…

âœ… **ç¨³å®šæ€§éªŒæ”¶**:
- ç½‘ç»œå¼‚å¸¸æœ‰é‡è¯•
- APIé”™è¯¯æœ‰æç¤º
- ä¸å½±å“å…¶ä»–åŠŸèƒ½

---

## åã€é™„å½•

### 10.1 ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `services/ai_service.py` | æ·»åŠ  `result_format` å‚æ•°ï¼Œå¢å¼ºé”™è¯¯å¤„ç† |
| `å‚è€ƒä»£ç /qwen_api_demo.py` | å‚è€ƒç¤ºä¾‹ï¼ˆæœªä¿®æ”¹ï¼‰ |

### 10.2 APIæ–‡æ¡£é“¾æ¥

- é€šä¹‰åƒé—®APIæ–‡æ¡£: https://help.aliyun.com/zh/dashscope/
- APIè°ƒç”¨ç¤ºä¾‹: https://dashscope.aliyun.com/
- æ¨¡å‹å®šä»·: https://help.aliyun.com/zh/dashscope/pricing

### 10.3 æµ‹è¯•è„šæœ¬

å®Œæ•´æµ‹è¯•è„šæœ¬å·²ä¿å­˜åœ¨é¡¹ç›®ä¸­ï¼ˆä¸´æ—¶æ–‡ä»¶ï¼Œå·²åˆ é™¤ï¼‰ï¼š
```bash
# è¿è¡Œæµ‹è¯•
python test_ai_service.py
```

---

**æŠ¥å‘Šå®Œæˆæ—¶é—´**: 2026-02-18 16:00:00  
**è°ƒè¯•çŠ¶æ€**: âœ… é—®é¢˜å·²å®Œå…¨è§£å†³  
**ä»£ç çŠ¶æ€**: âœ… å·²æäº¤ï¼Œæµ‹è¯•é€šè¿‡  
**ç”¨æˆ·ç¡®è®¤**: â³ å¾…ç”¨æˆ·éªŒè¯

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
1. â³ ç”¨æˆ·éªŒè¯ä¿®å¤æ•ˆæœ
2. â³ æ”¶é›†å®é™…ä½¿ç”¨åé¦ˆ
3. â³ è€ƒè™‘å®æ–½åç»­ä¼˜åŒ–å»ºè®®
