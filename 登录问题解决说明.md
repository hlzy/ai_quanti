# 登录问题已解决！✅

## 问题原因

您之前无法使用 `admin/admin123` 登录是因为：

1. **SQLite数据库中没有users表** - 数据库需要重新初始化
2. **admin账户未创建** - 需要运行初始化脚本创建管理员账户

## 解决方案

已经完成以下修复：

### 1. 更新了SQLite数据库结构
- ✅ 添加了users表
- ✅ positions表添加user_id字段
- ✅ cash_balance表添加user_id字段
- ✅ chat_history表添加user_id字段

### 2. 重新初始化数据库
```bash
rm -f data/quanti_stock.db
python -c "from database import db_manager; db_manager.init_database()"
```

### 3. 创建了admin账户
```bash
python check_admin_sqlite.py
```

### 4. 测试登录功能
```bash
python test_login.py
```
**测试结果：✅ 所有测试通过！**

## 现在可以正常登录了！

### 登录信息
- **URL**: http://localhost:5000/login
- **用户名**: `admin`
- **密码**: `admin123`

### 启动应用
```bash
cd /Users/sunjie/CodeBuddy/ai_quanti
python app.py
```

然后在浏览器中访问 http://localhost:5000/login

## 验证步骤

如果再次遇到登录问题，可以运行检查脚本：

```bash
python check_admin_sqlite.py
```

这个脚本会：
- ✅ 检查数据库是否存在
- ✅ 检查users表是否存在
- ✅ 检查admin账户是否存在
- ✅ 验证密码哈希是否正确
- ✅ 如果有问题会自动修复

## 创建新用户

登录后，作为管理员，您可以：

1. 访问 http://localhost:5000/admin
2. 点击"添加用户"按钮
3. 创建新的普通用户账户

## 常用命令

### 检查admin账户
```bash
python check_admin_sqlite.py
```

### 测试登录功能
```bash
python test_login.py
```

### 查看数据库内容
```bash
sqlite3 data/quanti_stock.db "SELECT * FROM users;"
```

### 重置admin密码
如果忘记密码，运行：
```bash
python check_admin_sqlite.py
```
脚本会自动重置密码为 `admin123`

## 技术细节

### 密码加密方式
- 使用 **SHA-256** 哈希
- admin123 的哈希值: `240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9`

### 数据库位置
- **SQLite文件**: `data/quanti_stock.db`
- 使用SQLite而不是MySQL（更轻量，无需安装额外服务）

---

**问题解决日期**: 2026-02-20  
**状态**: ✅ 已解决，可以正常登录
